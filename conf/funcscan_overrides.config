/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Custom overrides for nf-core/funcscan
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Pin pyhmmer<0.12 for GECCO and DeepBGC to fix:
        AttributeError: 'str' object has no attribute 'decode'
    (pyhmmer >=0.12 changed hmm.accession from bytes to str)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

// BACASS_DIR is exported by setup.sh, available at runtime
def bacassDir = System.getenv('BACASS_DIR') ?: '/work3/josne/github/bacass'

process {
    withName: 'GECCO_RUN' {
        conda = "${bacassDir}/conf/gecco_environment.yml"
        // GECCO module's mv loop fails with "same file" when input.baseName == prefix.
        // GECCO itself succeeds — outputs are already correctly named. Ignore the mv error.
        errorStrategy = 'ignore'
    }
    withName: 'DEEPBGC_PIPELINE' {
        conda = "${bacassDir}/conf/deepbgc_environment.yml"
    }
    withName: 'AMPCOMBI2_COMPLETE' {
        // ampcombi complete requires >=2 summary files but single-sample runs only produce 1.
        // This is a summarization step — safe to ignore for single-sample runs.
        errorStrategy = 'ignore'
    }
}
